#
# Fixed APISIX configuration
#
deployment:
  role: traditional
  role_traditional:
    config_provider: yaml

apisix:
  node_listen: 9080
  enable_admin: false  # Disable admin API in standalone mode

routes:
  - id: 1
    name: "Health Test"
    uri: /health
    priority: 50
    upstream:
      type: roundrobin
      nodes:
        "httpbin.org:80": 1
      scheme: http

  - id: 20
    name: "Keycloak Admin Console"
    uri: /auth/*
    priority: 200
    upstream:
      type: roundrobin
      nodes:
        "keycloak-438091062981.us-central1.run.app:443": 1
      scheme: https
    plugins:
      cors:
        allow_origins: "*"
        allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS,HEAD"
        allow_headers: "Content-Type,Authorization,X-API-Key"
        expose_headers: "X-Request-ID"
        max_age: 86400
      request-id:
        header_name: "X-Request-ID"
        include_in_response: true
      proxy-rewrite:
        scheme: https
        host: keycloak-438091062981.us-central1.run.app
        regex_uri:
          - "^/auth/(.*)"
          - "/admin/master/console/$1"

#END
